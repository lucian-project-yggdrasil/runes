{"version":3,"sources":["../../src/core/database/repository.ts","../../src/core/domains/friend/index.ts","../../src/core/index.ts"],"sourcesContent":["import { type Container, CosmosClient } from \"@azure/cosmos\"\n\nexport class BaseRepository<T extends { id: string; tenantId: string }> {\n\tprivate container: Container | null = null\n\n\tconstructor(\n\t\tprivate connectionString: string,\n\t\tprivate databaseName: string,\n\t\tprivate containerName: string,\n\t) {}\n\n\tprivate async getContainer(): Promise<Container> {\n\t\tif (!this.container) {\n\t\t\tconst client = new CosmosClient(this.connectionString)\n\t\t\tconst db = client.database(this.databaseName)\n\t\t\tconst { container } = await db.containers.createIfNotExists({\n\t\t\t\tid: this.containerName,\n\t\t\t\tpartitionKey: \"/tenantId\",\n\t\t\t})\n\t\t\tthis.container = container\n\t\t}\n\t\treturn this.container\n\t}\n\n\t// Generic Query: Automatically enforces Tenant Isolation\n\tasync findByTenant(tenantId: string, querySpec?: string): Promise<T[]> {\n\t\tconst container = await this.getContainer()\n\n\t\t// Default to \"Select All\" if no custom query provided\n\t\tconst query = querySpec\n\t\t\t? `${querySpec} AND c.tenantId = @tenantId`\n\t\t\t: `SELECT * FROM c WHERE c.tenantId = @tenantId`\n\n\t\tconst { resources } = await container.items\n\t\t\t.query({\n\t\t\t\tquery,\n\t\t\t\tparameters: [{ name: \"@tenantId\", value: tenantId }],\n\t\t\t})\n\t\t\t.fetchAll()\n\n\t\treturn resources as T[]\n\t}\n\n\tasync create(item: T): Promise<T> {\n\t\tconst container = await this.getContainer()\n\t\tconst { resource } = await container.items.create(item)\n\t\treturn resource as T\n\t}\n}\n","import { z } from \"zod\"\n\nexport const FriendSchema = z.object({\n\tid: z.uuid(),\n\ttenantId: z.string(),\n\tname: z.string().min(1, \"Name is required\"),\n\tstatus: z.enum([\"Cold\", \"Warm\", \"Hot\"]),\n\tcreatedAt: z.iso.datetime(),\n\temail: z.email().optional(),\n\tlocation: z.string().optional(),\n})\n\nexport const CreateFriendSchema = FriendSchema.pick({\n\tname: true,\n\temail: true,\n\tlocation: true,\n}).extend({\n\tstatus: z.enum([\"Cold\", \"Warm\", \"Hot\"]).default(\"Warm\"),\n})\n\nexport type Friend = z.infer<typeof FriendSchema>\nexport type CreateFriendDto = z.infer<typeof CreateFriendSchema>\n","export * from \"./database/repository.js\"\nexport * from \"./domains/friend/index.js\"\n\nexport const greet = (name: string): string => {\n\treturn `Sk√•l, ${name}! The Core Runes are active.`\n}\n"],"mappings":";AAAA,SAAyB,oBAAoB;AAEtC,IAAM,iBAAN,MAAiE;AAAA,EAGvE,YACS,kBACA,cACA,eACP;AAHO;AACA;AACA;AAAA,EACN;AAAA,EANK,YAA8B;AAAA,EAQtC,MAAc,eAAmC;AAChD,QAAI,CAAC,KAAK,WAAW;AACpB,YAAM,SAAS,IAAI,aAAa,KAAK,gBAAgB;AACrD,YAAM,KAAK,OAAO,SAAS,KAAK,YAAY;AAC5C,YAAM,EAAE,UAAU,IAAI,MAAM,GAAG,WAAW,kBAAkB;AAAA,QAC3D,IAAI,KAAK;AAAA,QACT,cAAc;AAAA,MACf,CAAC;AACD,WAAK,YAAY;AAAA,IAClB;AACA,WAAO,KAAK;AAAA,EACb;AAAA;AAAA,EAGA,MAAM,aAAa,UAAkB,WAAkC;AACtE,UAAM,YAAY,MAAM,KAAK,aAAa;AAG1C,UAAM,QAAQ,YACX,GAAG,SAAS,gCACZ;AAEH,UAAM,EAAE,UAAU,IAAI,MAAM,UAAU,MACpC,MAAM;AAAA,MACN;AAAA,MACA,YAAY,CAAC,EAAE,MAAM,aAAa,OAAO,SAAS,CAAC;AAAA,IACpD,CAAC,EACA,SAAS;AAEX,WAAO;AAAA,EACR;AAAA,EAEA,MAAM,OAAO,MAAqB;AACjC,UAAM,YAAY,MAAM,KAAK,aAAa;AAC1C,UAAM,EAAE,SAAS,IAAI,MAAM,UAAU,MAAM,OAAO,IAAI;AACtD,WAAO;AAAA,EACR;AACD;;;AChDA,SAAS,SAAS;AAEX,IAAM,eAAe,EAAE,OAAO;AAAA,EACpC,IAAI,EAAE,KAAK;AAAA,EACX,UAAU,EAAE,OAAO;AAAA,EACnB,MAAM,EAAE,OAAO,EAAE,IAAI,GAAG,kBAAkB;AAAA,EAC1C,QAAQ,EAAE,KAAK,CAAC,QAAQ,QAAQ,KAAK,CAAC;AAAA,EACtC,WAAW,EAAE,IAAI,SAAS;AAAA,EAC1B,OAAO,EAAE,MAAM,EAAE,SAAS;AAAA,EAC1B,UAAU,EAAE,OAAO,EAAE,SAAS;AAC/B,CAAC;AAEM,IAAM,qBAAqB,aAAa,KAAK;AAAA,EACnD,MAAM;AAAA,EACN,OAAO;AAAA,EACP,UAAU;AACX,CAAC,EAAE,OAAO;AAAA,EACT,QAAQ,EAAE,KAAK,CAAC,QAAQ,QAAQ,KAAK,CAAC,EAAE,QAAQ,MAAM;AACvD,CAAC;;;ACfM,IAAM,QAAQ,CAAC,SAAyB;AAC9C,SAAO,YAAS,IAAI;AACrB;","names":[]}